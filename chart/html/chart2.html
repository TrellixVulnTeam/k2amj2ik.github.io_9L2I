# 작가별 카테고리별 일별 BIE 산출 # 1. 특정 달을 정하고, 해당 작가의 해당 달이전 12개월의 평균 낙찰가를 계산한다. # 2. 매달 기준으로 위 작업을 반복한다. # 3. 월별 지수 결과를 DB에 업데이트 해둔다. # 4. 매월 초 해당 작업을 반복한다. # 1. 특정 달을 정하고, 해당 작가의 해당 달이전 12개월의 평균 낙찰가를 계산한다. SELECT L.artist_name AS artistName, L.lot_category AS Category, "$$$$2021-07-01 00:00:00$$$$" AS "referenceDay", #이 시점 이전 1년의 랏이 대상이 됨. #	MIN(SUBSTRING(R.auction_date_kst,1,7)) AS "From", #	MAX(SUBSTRING(R.auction_date_kst,1,7)) AS "To", ROUND(AVG(R.lot_price_usd_prem / T.size_cm_square),1) AS "price", ROUND(AVG(R.lot_price_usd_prem / T.size_cm_square) * ( SELECT C.per_usd FROM exchange_rate_v1 AS C WHERE C.currency = "KRW" ) ,1) AS "priceKrw" FROM dt_lot_result AS R INNER JOIN dt_lot AS L ON R.lot_idx = L.idx INNER JOIN dt_lot_token AS T ON T.lot_idx = L.idx INNER JOIN exchange_rate_v1 AS C ON R.lot_currency = C.currency WHERE L.artist_name = "gerhard richter" AND R.auction_date_kst BETWEEN DATE_SUB("$$$$2021-07-01 00:00:00$$$$", INTERVAL 1 YEAR) AND$$$$"2021-07-01 00:00:00$$$$" ORDER BY R.auction_date_kst ASC # 2. 매달 기준으로 위 작업을 반복한다. # 엑셀에서 날짜를 월단위로 변경한 후 셀렉트 구문을 반복하여 생성한다. # 셀렉트를 인서트로 변경하여 bi_index 테이블에 넣는다.